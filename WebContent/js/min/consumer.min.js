function populateDrugNameField(){var e=$.ajax({type:"get",url:"https://api.fda.gov/drug/event.json?&count=patient.drug.medicinalproduct",crossDomain:!0});e.done(getAllMedicinalProductsSuccess),e.fail(getAllMedicinalProductsFail)}function getAllMedicinalProductsSuccess(e){for(var t=[],a=0;a<e.results.length;a++)t.push(e.results[a].term);$("#inputSearchCriteria").autocomplete({source:t})}function getAllMedicinalProductsFail(){alert("the call has failed! Refresh the page")}function createRequestURL(){var e=!0,t="https://api.fda.gov/drug/event.json?",a=t,i="",r="",s="",n=[],l=$("#inputSearchCriteria").val();""!=l&&(e&&(a+="&search=",e=!1),a=a+"medicinalproduct:"+l,i=a+"&count=patient.reaction.reactionmeddrapt.exact",n.push({urlOnlyForDrug:i})),0!==isSerious&&(e?(a+="search=",e=!1):a+="+AND+",1==isSerious?(a+="serious:1",r=a+"&count=patient.reaction.reactionmeddrapt.exact",n.push({urlOnlyForSerious:r})):(a+="serious:2",s=a+"&count=patient.reaction.reactionmeddrapt.exact",n.push({urlOnlyForNonSerious:s})));var o=$("#selectOutcomes").val(),c=[],u=a,d="";if(null!=o){a+=a!==t?"+AND+":"&search=";for(var h=0;h<o.length;h++)d=0==h&&h==o.length-1?d+"("+o[h]+":1)":0==h?d+"("+o[h]+":1":h==o.length-1?d+o[h]+":1)":d+o[h]+":1",c.push(u+"+AND+"+o[h]+":1&count=patient.reaction.reactionmeddrapt.exact"),h!==o.length-1&&(d+="+");n.push({allOutcomeURL:c})}a=a+d+"&count=patient.reaction.reactionmeddrapt.exact",makeAjaxCallForThisURL(a),makeIndividualAjaxCallsForThisObject(n)}function makeAjaxCallForThisURL(e){var t=$.ajax({type:"get",url:e,crossDomain:!0});t.done(ajaxGetCustomResultsSuccess),t.fail(ajaxGetCustomResultsFail)}function ajaxGetCustomResultsSuccess(e){if("error"in e);else{var t=e.results;t=t.slice(0,10),convertDataToChartReadable(t)}}function ajaxGetCustomResultsFail(){$(".chart").css("display","none"),$(".placeholder").css("display","none"),$("#ajaxErrorNoReturnData").fadeIn()}function makeIndividualAjaxCallsForThisObject(){}function convertDataToChartReadable(e){for(var t=[],a=[],i=[],r=0;r<e.length;r++)t.push(e[r].term),i.push(e[r].count);a.push({label:"Total",values:i});var s={labels:t,series:a};initializeBreadCrumbs(),renderGraph(s)}function initializeBreadCrumbs(){$(".breadcrumb").html("");var e="",t=$("#inputSearchCriteria").val(),a=$("#selectOutcomes").val();null!=t&&(e=e+"<li> "+t+" </li>"),0!=isSerious&&(e+=1==isSerious?"<li> serious </li>":"<li> non-serious </li>");var i="";if(null!=a){for(var r="",s=0;s<a.length;s++){switch(a[s]){default:case"seriousnessdeath":r="results in death";break;case"seriousnesslifethreatening":r="life-threatening";break;case"seriousnesshospitalization":r="caused/prolonged hospitalization";break;case"seriousnessdisabling":r="disabling/Incapacitating";break;case"seriousnesscongenitalanomali":r="congenital anomaly/birth defect";break;case"seriousnessother":r="other medically important condition"}0==s&&s==a.length-1?i=i+"<li> "+r+" </li>":0==s?i=i+"<li> "+r:s==a.length-1?i=i+r+" </li>":i+=r,s!==a.length-1&&(i+=", ")}e+=i}$(".breadcrumb").append(e)}function renderGraph(e){$(".chart").html(""),$(".placeholder").css("display","none"),$("#ajaxErrorNoReturnData").css("display","none"),$(".chart").fadeIn();for(var t=e,a=5*$(".chartWell").width()/7,i=20,r=i*t.series.length,s=15,n=2*$(".chartWell").width()/7,l=[],o=0;o<t.labels.length;o++)for(var c=0;c<t.series.length;c++)l.push(t.series[c].values[o]);var u=d3.scale.category20(),d=i*l.length+s*t.labels.length,h=d3.scale.linear().domain([0,d3.max(l)]).range([0,a]),f=d3.scale.linear().range([d+s,0]),p=d3.svg.axis().scale(f).tickFormat("").tickSize(0).orient("left"),g=d3.select(".chart").attr("width",n+a).attr("height",d),m=g.selectAll("g").data(l).enter().append("g").attr("transform",function(e,a){return"translate("+n+","+(a*i+s*(.5+Math.floor(a/t.series.length)))+")"});m.append("rect").attr("fill",function(e,a){return u(a%t.series.length)}).attr("class","bar").attr("width",h).attr("height",i-1),m.append("text").attr("x",function(e){return h(e)-3}).attr("y",i/2).attr("fill","red").attr("dy",".35em").text(function(e){return e}),m.append("text").attr("class","label").attr("x",function(){return-10}).attr("y",r/2).attr("dy",".35em").text(function(e,a){return a%t.series.length===0?t.labels[Math.floor(a/t.series.length)]:""}),g.append("g").attr("class","y axis").attr("transform","translate("+n+", "+-s/2+")").call(p)}function setStateSerious(){isSerious=1,$("#seriousSignificant").removeClass("btn-default").addClass("btn-primary"),$("#nonSeriousSignificant").removeClass("btn-primary").addClass("btn-default")}function setStateNonSerious(){isSerious=2,$("#selectOutcomes").val(""),$(".list-group-item").removeClass("active"),$("#nonSeriousSignificant").removeClass("btn-default").addClass("btn-primary"),$("#seriousSignificant").removeClass("btn-primary").addClass("btn-default")}function clearSignificanceState(){isSerious=0,$("#nonSeriousSignificant").removeClass("btn-primary").addClass("btn-default"),$("#seriousSignificant").removeClass("btn-primary").addClass("btn-default")}function resetFields(){clearSignificanceState(),$("#divOutcomes").fadeIn(),$("#inputSearchCriteria").val(""),$(".list-group-item").removeClass("active")}var isSerious=0;$(document).ready(function(){var e=$("#nonSeriousSignificant"),t=$("#seriousSignificant"),a=$("#divOutcomes"),i=$("#generateChartButton"),r=($("#inputSearchCriteria"),$("#resetButton"));e.off("click"),e.on("click",function(){a.fadeOut(),setStateNonSerious()}),t.off("click"),t.on("click",function(){a.fadeIn(),setStateSerious()}),populateDrugNameField(),i.off("click"),i.on("click",createRequestURL),r.off("click"),r.on("click",resetFields)});